dist: bionic
language: python
python:
    - 3.8
env:
  global:
    - OWNER=${TRAVIS_REPO_SLUG%/*}
git:
  depth: false
before_install:
  - git tag
install:
  - sudo apt-get -y install libsecp256k1-0
  - pip install -r contrib/requirements/requirements-travis.txt
cache:
  - pip: true
  - directories:
    - /tmp/electrum-build
script:
    - tox
after_success:
    - coveralls
jobs:
  include:
    - if: branch = slack_ci
      name: "Native Android build"
      services:
        - docker
      install:
        - while sleep 60; do echo "=====[ $SECONDS seconds still running ]====="; done &
        - sudo docker pull lightningcn/electrum_env:latest
      script:
        # Output something every minute or Travis kills the job
        - while sleep 60; do echo "=====[ $SECONDS seconds still running ]====="; done &
        - sudo docker run --rm -it --name electrum-android-native-builder-cont -v $PWD:/data 
          --workdir=/data/android lightningcn/electrum_env:latest /bin/bash -c 
          'cp debug.keystore ~/.android/debug.keystore && /data/android/gradlew app:assembleDebug'
        # kill background sleep loop
        - kill %1

notifications:
  slack:
    rooms:
      secure: H7iyO0TVMX+Navp7GfIFfOcxF9ZrMB40yUm5C8JKMpUrWUs8lA+BlmezeE3gl68ktq6yLVy8ZCgwLbXIcOoFp+rXORZeM+9avEZaFID8bfAaGayqhmKnzv6P8Ue3y/vSKxe/YFGeBNgrvBy9Qa6n9fj8l1v+K5fozFSDl9V3G0M1TOud+Q7SKTTUHCBjau/M/jrROlsJUx9P5j+VQJeouR18qhTDz0TkLlcwPd36SBWwyCEli22wEfc3pY5Jjay2oHErtxxyouTpsXAlQZo/GL8LHKwiaYAnEweqgnsyXqcqQRc/86/85LBUJO6XU9ss5LcCIcCwYukRARwjFh6BY5hnQWlhXjPLfVhg8a/sOR0pyektapFWejmSdP+jDgILI7cdZXMCuZ2bpHkEBVgpyyQHLFDNiFcS3V6xs9Kx3zsmT01hV8Vo6bsSq5LBEBXUAJPzEeh/BoFwBiZycC5gj4GJZ6RPnAt2OOwBn6zoNI03rYU4/R/906Ku2J7JjE/2bXtkyMF69D5qU/NyEiDK6xgWx227MITOiQ0qoFI+fcj6MBPLYAkt7dAYRFdHzTiDx+3JQBK6sOtUkT+zoZQLWfMz0LiLTDZTYWS2cdwupYH0yU3a5jPb3CUBbvUCMskGEmR6ewnFUvJewokYFbuC7yvruscnjmz5tayPmWoRYmo=
  on_success: always  # change: send a notification when the build status changes.
  on_failure: always  # always: always send a notification.
