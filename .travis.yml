dist: bionic
language: python
python:
    - 3.8
env:
  global:
    - OWNER=${TRAVIS_REPO_SLUG%/*}
git:
  depth: false
before_install:
  - git tag
install:
  - sudo apt-get -y install libsecp256k1-0
  - pip install -r contrib/requirements/requirements-travis.txt
cache:
  - pip: true
  - directories:
    - /tmp/electrum-build
script:
    - tox
after_success:
    - coveralls
jobs:
  include:
    - if: branch = slack_ci
      name: "Native Android build"
      services:
        - docker
      install:
        - while sleep 60; do echo "=====[ $SECONDS seconds still running ]====="; done &
        - sudo docker pull lightningcn/electrum_env:latest
      script:
        # Output something every minute or Travis kills the job
        - while sleep 60; do echo "=====[ $SECONDS seconds still running ]====="; done &
        - sudo docker run --rm -it --name electrum-android-native-builder-cont -v $PWD:/data 
          --workdir=/data/android lightningcn/electrum_env:latest /bin/bash -c 
          'cp debug.keystore ~/.android/debug.keystore && /data/android/gradlew app:assembleDebug'
        # kill background sleep loop
        - kill %1

notifications:
  slack:
    rooms:
      secure: JZDgw2MDcWGENVOmvfswjoW+lsmYF/olSr1VfW5RhoQmex9zN4uYyM0jyUhsAjmsqSYoT0SvaIfNOqzvKPpbCrxb6oZnm/EC5Bbu5Eh9dWyVky1kDTHUMjvc0/msdEkXQ0/N3LK7Mn9EC6EvLlslWsIqJhF5fC8P6LtEWdN6iFP5g4Vurm8lh2fM14Kwd4lHD9mLu4Feiw9uFYXA9uIKDfhW37lZte51NbfffGmGr89z27g+K+iSCnhkrLnTAlF5R5/9C60bbLXGeSGdmIrkjFGO/6nqhq/k3lN8gBEYXoxbNI8jSfp7kT4Z432aFCqW2Q67Q8VOxNzTt7+BpXpRfDODo8UItdwMzNJ/475bcef5Qw8HS6aM31FDn9BxgsZNgb+y4af1VxmY0HYdFUhEq12NXY+VBUSJ6TV/gASkDgwz4ssN7Uqg7eymrPQQJvfcBQB+e7hRRnku/nyEZ4tfizkdthj/bDk/FM7xPy+JTIlIn38YGTw2Au5L2DyQQSJn05u56n4UgNrDdSbWyi0Ga7/8z25Ni54IAHjzRvqE56k6TkLyiyGzA5K4IT+sZKIC19S++zwZOzAjc0NhWF0IK9W/cZet1t1cD10r8pUaXkxjvvkgGDwINRE5DMdEzq1tGBkEg74J+y4NqUQS3tNYOfjMYBo/G11Ae5iM/NqRMm0=
  on_success: always  # change: send a notification when the build status changes.
  on_failure: always  # always: always send a notification.
